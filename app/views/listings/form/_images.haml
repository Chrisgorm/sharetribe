= form.label :image, t('.image'), :class => "input"
%input#listing-image-id{type: "hidden", name: "listing_image[id]"}
.listing-images#image-uploader-container

  %script{type: "text/template", class: "template", id: "new-image-tmpl"}
    #fileupload.fileinput-button.upload-image-placeholder
      .fileupload-text-container
        .fileupload-centered-text
          .fileupload-text
            = t(".select_file")
          .fileupload-small-text
      %input#fileupload{type: "file", name: "${fileInputName}"}

  %script{type: "text/template", class: "template", id: "thumbnail-image-tmpl"}
    .fileupload-preview
      %img.fileupload-preview-image{src: "${thumbnailUrl}"}
      .fileupload-removing
        .fileupload-text-container
          .fileupload-centered-text
            = t(".removing")
      .fileupload-preview-remove-image
        = icon_tag("cross", ["icon-fix"])

= js_t ["listings.form.images.processing", "listings.form.images.this_may_take_a_while", "listings.form.images.percentage_loaded", "listings.form.images.uploading_failed", "listings.form.images.file_too_large", "listings.form.images.accepted_formats"], run_js_immediately

- content_for :image_uploader_js do
  :javascript
    $(function() {
      var opts = #{ListingImageS3OptionsJSAdapter.new(@listing).to_json}
      var listingsImages = #{ @listing.listing_images.map { |image| ListingImageJSAdapter.new(image) }.to_json }

      ST.imageUploader(listingsImages, opts);
    });

- if run_js_immediately
  = yield :image_uploader_js
- else
  - content_for :extra_javascript do
    = yield :image_uploader_js